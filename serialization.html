

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Serialization &mdash; yggdrasil 0.8.7 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="_static/theme_overrides.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="yggdrasil 0.8.7 documentation" href="index.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> yggdrasil
          

          
          </a>

          
            
            
              <div class="version">
                0.8.7
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="includeme.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="formatted_io.html">Formatted I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="server_client_io.html">Server/Client I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="server_client_io.html#one-server-two-clients">One Server, Two Clients</a></li>
<li class="toctree-l1"><a class="reference internal" href="yaml.html">YAML Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="config.html">Configuration Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="units.html">Units</a></li>
<li class="toctree-l1"><a class="reference internal" href="c_format_strings.html">C-Style Format Strings</a></li>
<li class="toctree-l1"><a class="reference internal" href="io_drivers.html">Input/Output Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="model_drivers.html">Model Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="model_interface.html">Model Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="metaschema.html">JSON Metaschema</a></li>
<li class="toctree-l1"><a class="reference internal" href="schema.html">YAML Validation Schema</a></li>
<li class="toctree-l1"><a class="reference internal" href="code.html">Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples/examples_toc.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="release.html">Release Steps</a></li>
<li class="toctree-l1"><a class="reference internal" href="release.html#updating-and-testing-the-conda-recipe">Updating and Testing the Conda Recipe</a></li>
<li class="toctree-l1"><a class="reference internal" href="release.html#docs-checkout">Docs Checkout</a></li>
<li class="toctree-l1"><a class="reference internal" href="hackathon2018/index.html">Welcome to the 2018 Crops in Silico Hackathon!</a></li>
<li class="toctree-l1"><a class="reference internal" href="publications.html">Publications</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">yggdrasil</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Serialization</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/serialization.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="serialization">
<span id="serialization-rst"></span><h1>Serialization<a class="headerlink" href="#serialization" title="Permalink to this headline">¶</a></h1>
<p>Serialization, as describes here, refers to the process of turning a variable
of some type in the sending model’s language into bytes and then reversing
the process (deserialization) by turning the bytes into a variable of an
analagous type in the language of the receiving model.</p>
<p>For most types, yggdrasil uses an enhanced version of
the <a class="reference external" href="https://www.json.org/">JSON data interchange format</a> to serialize
data structures and uses <a class="reference external" href="https://json-schema.org/">JSON Schema</a> to describe
and validate them. The use of JSON and JSON schema has the advantage that there
are many existing tools for reading, writing, and validating JSON serialized
data that will make it easier to expand support to other languages in the future.
For more complex data structures that are not easily or efficiently represented in
JSON, yggdrasil supports serialization classes that are associated with a new
expansion type to the core set of JSON types.</p>
<p>The mapping between datatypes in the different supported languages is shown below.</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 8%" />
<col style="width: 13%" />
<col style="width: 14%" />
<col style="width: 9%" />
<col style="width: 20%" />
<col style="width: 36%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Schema</p></th>
<th class="head"><p>Python</p></th>
<th class="head"><p>Matlab</p></th>
<th class="head"><p>C</p></th>
<th class="head"><p>C++</p></th>
<th class="head"><p>Notes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>int</p></td>
<td><p>numpy.intX</p></td>
<td><p>intX</p></td>
<td><p>intX_t</p></td>
<td><p>intX_t</p></td>
<td><p>Precision X is preserved.</p></td>
</tr>
<tr class="row-odd"><td><p>float</p></td>
<td><p>numpy.floatX</p></td>
<td><p>single, double</p></td>
<td><p>floatX_t</p></td>
<td><p>floatX_t</p></td>
<td><p>Precision X is preserved.</p></td>
</tr>
<tr class="row-even"><td><p>string</p></td>
<td><p>str</p></td>
<td><p>char</p></td>
<td><p>char*</p></td>
<td><p>char*</p></td>
<td><p>Encoding dependent on JSON library.</p></td>
</tr>
<tr class="row-odd"><td><p>array</p></td>
<td><p>list</p></td>
<td><p>cell</p></td>
<td><p>vector_t</p></td>
<td><p>std::vector&lt;void*&gt;</p></td>
<td><p>Support for dynamic arrays in C/C++
is still under development.</p></td>
</tr>
<tr class="row-even"><td><p>object</p></td>
<td><p>dict</p></td>
<td><p>containers.Map</p></td>
<td><p>map_t</p></td>
<td><p>std::map&lt;char*,void*&gt;</p></td>
<td><p>Support for dynamic objects in C/C++
is still under development.</p></td>
</tr>
<tr class="row-odd"><td><p>bool</p></td>
<td><p>bool</p></td>
<td><p>logical</p></td>
<td><p>bool</p></td>
<td><p>bool</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>null</p></td>
<td><p>None</p></td>
<td><p>NaN</p></td>
<td><p>NULL</p></td>
<td><p>NULL</p></td>
<td></td>
</tr>
</tbody>
</table>
<p>uint        numpy.uintX       uintX              uintX_t      uintX_t                  Precision X is preserved.
complex     numpy.complexX    complex            complex_X    complex_X                Precision X is preserved.
bytes       bytes             char (utf-8)       char*        char*
unicode     str               char               char*        char*
1darray     numpy.ndarray     mat                *            *
ndarray     numpy.ndarray     mat                *            *
ply         PlyDict           containers.Map     ply_t        ply_t
obj         ObjDict           containers.Map     obj_t        obj_t
function    function          function_handle    n/a          n/a                      Function types are currently only</p>
<blockquote>
<div><p>available in interpreted languages.</p>
</div></blockquote>
<p>schema      dict              containers.Map     map_t        MetaschemaType
========    ==============    ===============    =========    =====================    ======================================</p>
<div class="section" id="message-structure">
<h2>Message Structure<a class="headerlink" href="#message-structure" title="Permalink to this headline">¶</a></h2>
<p>Each message consists of two parts, the header and the body which are joined by
a dedicated string <code class="docutils literal notranslate"><span class="pre">YGG_MSG_HEAD</span></code> such that:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">message</span> <span class="o">=</span> <span class="s1">&#39;YGG_MSG_HEAD&lt;header&gt;YGG_MSG_HEAD&lt;body&gt;&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="message-header">
<h2>Message Header<a class="headerlink" href="#message-header" title="Permalink to this headline">¶</a></h2>
<p>Message headers are serialized JSON objects with properites that describe the message
and can be used to deserialize and validate the message on receipt. Although each
header can contain any information, at a minimum the header must include the
following properties:</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 12%" />
<col style="width: 9%" />
<col style="width: 40%" />
<col style="width: 40%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Property</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Purpose</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>type</p></td>
<td><p>string</p></td>
<td><p>Name of body datatype.</p></td>
<td><p>Deserialization and message
validation.</p></td>
</tr>
<tr class="row-odd"><td><p>size</p></td>
<td><p>int</p></td>
<td><p>Size of message body.</p></td>
<td><p>Verifying that the received
message is complete.</p></td>
</tr>
<tr class="row-even"><td><p>id</p></td>
<td><p>string</p></td>
<td><p>Unique message identifier.</p></td>
<td><p>Message tracking.</p></td>
</tr>
</tbody>
</table>
<p>Depending on the datatype of the object encoded in the body, additional properties
may be required in order to deserialize and/or validate the object. The properties
required by each type are defined in the yggdrasil
<a class="reference internal" href="metaschema.html#metaschema-rst"><span class="std std-ref">JSON metaschema</span></a>. On deserialization, the header is
validated against the metaschema, used to inform deserialization of the body, and
then used as a JSON schema to validate the decoded data decoded from the body of the message.</p>
<p>In addition to type information, the header is also used to pass information
between models reguarding communication. This information can include things
like addresses of temporary communication resources, acknowledgement that a
message was received, and notifications about new or broken connections.</p>
</div>
<div class="section" id="message-body">
<h2>Message Body<a class="headerlink" href="#message-body" title="Permalink to this headline">¶</a></h2>
<p>The message body is also a serialized JSON document, but during the encoding
process, data of some types undergo an additional pre-encoding step in order
to transform the data into a form that is more efficiently JSON encodable prior
to actually serializing the data via JSON encoding. For
example, encoding one million 64bit floats would 1) produce a very large JSON
array and 2) require a large number of digits in order to preserve precision to
the level of round-off error as would be expected when passing floats between
programs written in the same language. For such datatypes, it is more efficient
to use an alternative method of pre-encoding the data into a form that can be
efficiently JSON encoded.</p>
<div class="section" id="scalars">
<h3>Scalars<a class="headerlink" href="#scalars" title="Permalink to this headline">¶</a></h3>
<p>In addition to being limited in its representation of numbers such that
precision can be lost during encoding/decoding, JSON also dosn’t support
complex numbers or unsigned integers as primary types. To overcome this
limitation, yggdrasil passes scalar numbers by pre-encoding their raw
bytes into an ASCII string representation using the standard
<a class="reference external" href="https://tools.ietf.org/html/rfc3548.html">base64</a> encoding. To allow
decoding and validation on receipt of encoded scalars, yggdrasil includes
the subtype (float, int, uint, complex), precision (in bits), and units in the
the message header.</p>
</div>
<div class="section" id="strings">
<h3>Strings<a class="headerlink" href="#strings" title="Permalink to this headline">¶</a></h3>
<p>Because there are a large number of string encodings (e.g. ASCII, UTF-8)
with varying degrees of support in different languages, yggdrasil supports
three different string related types. In addition to the core JSON <code class="docutils literal notranslate"><span class="pre">string</span></code>
type, which will be encoded and mapped to a datatype in
the programming language of the receiving model according to the JSON
implementation that is used (the JSON spec indicates UTF-8 should be used by
default), yggdrasil also supports types of <code class="docutils literal notranslate"><span class="pre">unicode</span></code> and <code class="docutils literal notranslate"><span class="pre">bytes</span></code>.
Data identified with the <code class="docutils literal notranslate"><span class="pre">bytes</span></code> type will be pre-encoded as ASCII strings
using the base64 encoding. Data identified with the <code class="docutils literal notranslate"><span class="pre">unicode</span></code> type will
be pre-encoded by encoding them as bytes using UTF-32 and then encoding those
bytes as ASCII strings using the base64 encoding.</p>
<p>and <code class="docutils literal notranslate"><span class="pre">bytes</span></code>. Data specified as either type are pre-encoded like scalars by
using base64 to encode the raw-bytes representing the data. However, on
receipt, messages containing data specified as <code class="docutils literal notranslate"><span class="pre">unicode</span></code> be decoded and
stored in a unicode data type if one is available in the receiving language.
If the receiving language dosn’t have a built-in unicode type (e.g. C</p>
</div>
<div class="section" id="homogeneous-arrays">
<h3>Homogeneous Arrays<a class="headerlink" href="#homogeneous-arrays" title="Permalink to this headline">¶</a></h3>
<p>As mentioned above, large arrays can produce large JSON documents that can
dramatically increase the size of messages and thereby the time required to
send/receive data. However, as most languages provide built-in support for
arrays that are continuous in memory, it is much more efficient to pass the
arrays in a continuous format. Arrays elements are encoded in the same way
as scalars using base64 in row-major order. On receipt, languages which are
column-major order must re-order the data. As is dont for scalars,
yggdrasil passes the data subtype, precision, and units for arrays and
also sends the array size
(for one-dimensional arrays) or array shape (for multi-dimensional arrays).
Arrays of strings are also serialized in this way, but strings are padded
so that every string has the same width (i.e. elements are fixed width).</p>
<p>For languages that allow for mixed-type arrays, yggdrasil sends these
data as JSON arrays of the differently typed elements (or JSON objects if
field names are provided).</p>
</div>
<div class="section" id="ply-obj">
<h3>Ply/Obj<a class="headerlink" href="#ply-obj" title="Permalink to this headline">¶</a></h3>
<p>Ply and Obj file formats are designed to efficiently represent 3D structures
containing large numbers of elements that would require large JSON
structures containing nested objects and arrays. As such, yggdrasil defines
Ply and Obj objects as their own data types that are serialized using the Ply and
Obj file standards during pre-encoding.</p>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Meagan Lang, David Raila.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.8.7',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="_static/language_data.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>